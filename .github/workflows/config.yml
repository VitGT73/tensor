name: UI Tests

on: workflow_dispatch

jobs:
  ui-test:
    runs-on: ubuntu-latest

    steps:
        - name: Checkout repository
          uses: actions/checkout@v3

        - name: Run selenium-hub via docker-compose
          run: docker-compose -f docker-compose-hub.yml up -d

        - name: Run Dockerfile with Python
          run: docker-compose -f docker-compose-pytest.yml up -d

        - name: Run UI-tests
          env:
            SELENIUM_GRID_USE: 0
          run: |
            docker compose -f docker-compose-pytest.yml exec pytest pytest --browser=chrome -sv --alluredir=allure-results || true

        - name: Generate Allure report to allure-report
          run: docker compose -f docker-compose-pytest.yml exec pytest allure generate --clean

        - name: Deploy to Github Pages
          uses: JamesIves/github-pages-deploy-action@4.1.5
          with:
            token: ${{ secrets.GHP_TOKEN }}
            branch: gh-pages
            folder: allure-report
            clean: true
